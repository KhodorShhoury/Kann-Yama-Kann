<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kann Yama Kann</title>
    <link rel="stylesheet" href="../css/normalize.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../css/all.min.css" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet" />
    <!-- swiper.js -->
    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        :root{
        --main-color:#ec9a2f;
        --main-transition-duration:0.3s;
        --main-padding-top:100px;
        --main-padding-bottom:100px;
        --paragraph-color:#666;
        --black-color : #232D39;
        --box-shadow-color : #ddd;
        --grayish-color : #FAFAFA;
        --main-overlay-color: rgba(0,0,0,0.5);
        --main-border-radius : 8px;
        --section-background: #ececec;
    }
        *{
         padding: 0;
         margin: 0;
         box-sizing: border-box;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        }
        body{
            font-family: "cairo",sans-serif;
        }
        .container{
    padding-left: 15px;
    padding-right: 15px;
    margin-right: auto;
    margin-left: auto;
}
/* small */
@media (min-width:768px){
    .container{
         width: 750px;
    }
}
/* medium */
@media (min-width:992px){
    .container{
         width: 970px;
    }
}
/* large */
@media (min-width:1200px){
    .container{
         width: 1170px;
    }
}


        .form-container{
            margin: 50px 20px 0px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        @media(max-width:991px){
            .form-container{
                justify-content: center;
            }
        }

        .form-container .form{
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            text-align: start;
            flex: 0 0 45%;
        }
        .form-container .form .title{
            font-weight: 700;
            color: var(--main-color);
            font-size: 40px;
            text-align: center;
        }
        .form-container .form label{
            font-size: 18px;
            font-weight: 700;
            color: var(--main-color);
        }
        .form-container .form .input{
            display: block;
            border: none;
            outline: none;
            height: 40px;
            padding: 0px 10px;
            background-color: transparent;
            color: var(--main-color);
            border-radius: var(--main-border-radius);
            border: 2px solid var(--main-color);
            font-weight: 700;
            margin: 10px 0px;
            caret-color: var(--main-color);
        }
        .form-container .form .input::placeholder{
            color: var(--main-color);
            font-weight: bold;
        }
        .form-container .form .error{
            margin: 0px 0px 0px 10px;
            color: red;
            font-weight: 700;
            display: none;
        }
        .form-container .form .center{
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .form-container .form .button{
            padding: 15px 35px;
            background-color: var(--main-color);
            cursor: pointer;
        }
        .form-container .table-container{
            height: 100%;
            flex: 0 0 45%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            position: relative;
            height: 700px;
            overflow: scroll;
        }
        .form-container .table-container .table{
            position: absolute;
        }
    </style>
  </head>

<body>
    <div class="form-container container">
        
        <form action="" class="form">
            <h1 class="title">Control Panel</h1>
            <label for="meal-id">Meal ID:</label>
            <input class="input" type="text" id="meal-id" placeholder="Type meal id">
            <small class="error">error</small>


            <label for="meal-name">Meal Name:</label>
            <input class="input" type="text" id="meal-name" placeholder="Type meal name">
            <small class="error">error</small>

            <label for="meal-desc">Meal description:</label>
            <input class="input" type="text" id="meal-desc" placeholder="Type meal description">
            <small class="error">error</small>

            <label for="meal-price">Meal price:</label>
            <input class="input" type="text" id="meal-price" placeholder="Type meal price">
            <small class="error">error</small>

            <label for="meal-categ">Meal category:</label>
            <input class="input" type="text" id="meal-categ" placeholder="Type meal category">
            <small class="error">error</small>


            <label for="">Meal Image</label>
            <input class="input" type= "text" id="meal-image-name">
            <label id="exlab"></label>
            <img id="meal-image-progress"> 
            <label id="upprogress"></label>


            <div class="center">
                <button class="button" id="Insbtn" type="">Insert</button>
                <button class="button" id="Selbtn">Select</button>
                <button class="button"id="Updbtn">Update</button>
                <button class="button" id="Delbtn">Delete</button>
            </div>
        </form>
        <div class="table-container">
            <table  class="table">
                <thead>
                    <th>Meal-ID</th>
                    <th>Meal-Name</th>
                    <th>Meal-Description</th>
                    <th>Meal-price</th>
                    <th>Meal-Category</th>
                </thead>
                <tbody class="tbody1"></tbody>
            </table>
        </div>
    </div>




<!-- ------------------------------IMPORTS + CONFIGURATION---------------------------------------------------------- -->

    <script type="module">
        
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDc86l5nGQW5BgRZ87g0HiskLQFpojkF80",
          authDomain: "kann-yama-kann-firestore.firebaseapp.com",
          projectId: "kann-yama-kann-firestore",
          storageBucket: "kann-yama-kann-firestore.appspot.com",
          messagingSenderId: "138428441492",
          appId: "1:138428441492:web:03accd6edfc2e4b2b16581"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        

        import {getFirestore, doc, getDoc, getDocs, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField,onSnapshot} from "https://www.gstatic.com/firebasejs/9.8.4/firebase-firestore.js"

        const db = getFirestore();

        // -----------------------------------------------REFFERENCES-------------------------------------------

        let mealId = document.getElementById("meal-id");
        let mealName = document.getElementById("meal-name");
        let mealDesc = document.getElementById("meal-desc");
        let mealPrice = document.getElementById("meal-price");
        let mealCateg = document.getElementById("meal-categ");



        let insBtn = document.getElementById("Insbtn");
        let selBtn = document.getElementById("Selbtn");
        let updBtn = document.getElementById("Updbtn");
        let delBtn = document.getElementById("Delbtn");


        // -------------------------------------------- ADD Documents ------------------------------------------

        async function AddDocument_AutoID(e){
            e.preventDefault()
            var ref = collection(db, "meals");

            const docRef = await addDoc(
                ref, {
                    MealName : mealName.value,
                    MealDesc : mealDesc.value,
                    MealPrice : mealPrice.value + "$",
                    mealCateg : mealCateg.value,
                }
            )
            .then(()=>{
                alert("data has been added Succesfuly");
            })
            .catch((error)=>{

             alert("Unsuccesfuly data has not been added");
            });
            mealId.value = "";
                mealName.value = "";
                mealDesc.value = "";
                mealPrice.value = "";
                mealCateg.value = "";
            GetAllDocumentsOnce();
        }

        async function AddDocument_CustomID(e){
            e.preventDefault()
            var ref = doc(db, "meals",mealId.value);

             await setDoc(
                ref, {
                    MealId : mealId.value,
                    MealName : mealName.value,
                    MealDesc : mealDesc.value,
                    MealPrice : `$${mealPrice.value}`,
                    MealCateg : mealCateg.value,
                }
            )
            .then(()=>{
                alert("data has been added Succesfuly");
            })
            .catch((error)=>{

             alert("Unsuccesfuly data has not been added");
            });
                mealId.value = "";
                mealName.value = "";
                mealDesc.value = "";
                mealPrice.value = "";
                mealCateg.value = "";
            GetAllDocumentsOnce();
        }


        //----------------------------------------------------------Getting Documents----------------------------------------------------


        async function GetADocument(e){
            e.preventDefault();
            var ref = doc(db, "meals",mealId.value);
            const docSnap = await getDoc(ref)
            .then((docSnap)=>{
                
                mealName.value = docSnap.data().MealName;
                mealDesc.value = docSnap.data().MealDesc;
                mealPrice.value = docSnap.data().MealPrice;
                mealCateg.value = docSnap.data().MealCateg;
            }).catch(()=> alert("No Such Document"));
        }



        //---------------------------------------------------------Updating Document Data--------------------------------------------------

        async  function updateFieldsInADocument(e){
            e.preventDefault();

            var ref = doc(db, "meals",mealId.value);

            await updateDoc(
                ref, {
                    MealId : mealId.value,
                    MealName : mealName.value,
                    MealDesc : mealDesc.value,
                    MealPrice : mealPrice.value,
                    MealCateg : mealCateg.value,
                }
            )
            .then(()=>{
                alert("data has been updated Succesfuly");
            })
            .catch((error)=>{

            alert("Unsuccesfuly data has not been updated:" + error);
            });
                mealId.value = "";
                mealName.value = "";
                mealDesc.value = "";
                mealPrice.value = "";
                mealCateg.value = "";
            GetAllDocumentsOnce();
                    }

        //-----------------------------------------Deleting Document-------------------------------------------------------------------


        async function DeleteDocument(e){
            e.preventDefault()
            var ref = doc(db, "meals",mealId.value);
            const docSnap = await getDoc(ref);

            if(!docSnap.exists()){
                alert("Document does not exist");
                return;
            }

            await deleteDoc(ref)
            .then(()=>{
                alert("data has been deleted Succesfuly");
            })
            .catch((error)=>{

            alert("Unsuccesfuly data has not been deleted:" + error);
            });
                mealId.value = "";
                mealName.value = "";
                mealDesc.value = "";
                mealPrice.value = "";
                mealCateg.value = "";
            GetAllDocumentsOnce();
        }


        // --------------------------------------- buttons event -----------------------------------------------------------------------

        insBtn.addEventListener("click",AddDocument_CustomID);
        selBtn.addEventListener("click",GetADocument);
        updBtn.addEventListener("click",updateFieldsInADocument);
        delBtn.addEventListener("click",DeleteDocument)


        //----------------------------------------Table oF Data-----------------------------------

        let tableBody = document.querySelector(".tbody1")

         function AddItemToTable(mealId,mealName,mealDesc,mealPrice,mealCateg){

            let tableTr = document.createElement("tr");
            let tableTd1 = document.createElement("td");
            let tableTd2 = document.createElement("td");
            let tableTd3 = document.createElement("td");
            let tableTd4 = document.createElement("td");
            let tableTd5 = document.createElement("td");

            tableTd1.innerHTML = mealId;
            tableTd2.innerHTML = mealName;
            tableTd3.innerHTML = mealDesc ;
            tableTd4.innerHTML = mealPrice;
            tableTd5.innerHTML = mealCateg;


            tableTr.appendChild(tableTd1);
            tableTr.appendChild(tableTd2);
            tableTr.appendChild(tableTd3);
            tableTr.appendChild(tableTd4);
            tableTr.appendChild(tableTd5);

            tableBody.appendChild(tableTr);
        }


        function AddAllItemsToTable(meals){
                tableBody.innerHTML ="";
                meals.forEach(meal =>{
                    AddItemToTable(meal.MealId,meal.MealName,meal.MealDesc,meal.MealPrice,meal.MealCateg)
                })
            }


    async function GetAllDocumentsOnce(){
        const querySnapShot = await getDocs(collection(db,"meals"))

        var meals = [];

        querySnapShot.forEach(doc=>{
            meals.push(doc.data())
        })

        AddAllItemsToTable(meals)
    }

    async function GetAllDocumentsRealTime(){
        const dbRef = collection(db,"meals")


        onSnapshot(dbRef,(querySnapShot)=>{
            var meals = [];

            querySnapShot.forEach(doc => {
                meals.push(doc.data());
            });
            AddAllItemsToTable(meals)
        })
    }
    window.onload = GetAllDocumentsRealTime;
      </script>
</body>
</html>